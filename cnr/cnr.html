<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶∞‡ßÅ‡¶ü‡¶ø‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶Æ‡¶æ‡¶§‡¶æ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Tiro+Bangla&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Tiro Bangla', serif;
      background-color: #f2f2f2;
      padding: 10px;
      margin: 0;
    }
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }
    form {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    form label {
      display: flex;
      flex-direction: column;
      font-weight: bold;
      flex: 1 1 150px;
      min-width: 150px;
    }
    input, select, button {
      padding: 8px;
      font-size: 16px;
      font-family: 'Tiro Bangla', serif;
      border: 1px solid #999;
      border-radius: 6px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      margin-top: 20px;
    }
    th, td {
      border: 2px solid #333;
      padding: 10px;
      text-align: center;
      font-size: 16px;
      min-width: 100px;
    }
    th {
      background-color: #f0f0f0;
      font-weight: bold;
    }
    .editable-header {
      cursor: pointer;
    }
    .editable-header:hover {
      background-color: #e0e0e0;
    }
    .class-header {
      background-color: #e6f3ff;
      font-weight: bold;
    }
    /* ‡¶®‡¶§‡ßÅ‡¶® Row ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶á ‡¶∞‡¶ô ‡¶ì ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
    .class-subheader {
      background-color: #e6f3ff;
      font-weight: bold;
      cursor: pointer;
    }
    .editable-cell {
      cursor: pointer;
      position: relative;
    }
    .editable-cell:hover {
      background-color: #f9f9f9;
    }
    .download-buttons {
      text-align: center;
      margin-top: 20px;
    }
    .download-buttons button {
      margin: 5px;
    }
    @media screen and (max-width: 800px) {
      form {
        flex-direction: column;
        align-items: stretch;
      }
      form label {
        width: 100%;
      }
      th, td {
        font-size: 14px;
        padding: 8px;
        min-width: 80px;
      }
      table {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <h1>‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶∞‡ßÅ‡¶ü‡¶ø‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶Æ‡¶æ‡¶§‡¶æ</h1>

  <form id="routineForm">
    <label>‡¶ú‡¶æ‡¶Æ‡¶æ‡¶§:
      <select id="class" required>
        <option value="">‡¶ú‡¶æ‡¶Æ‡¶æ‡¶§ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
        <option>‡¶∂‡¶ø‡¶∂‡ßÅ</option>
        <option>‡¶™‡ßç‡¶∞‡¶•‡¶Æ</option>
        <option>‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º</option>
        <option>‡¶§‡ßÉ‡¶§‡ßÄ‡¶Ø‡¶º</option>
      </select>
    </label>

    <label>‡¶¶‡¶ø‡¶®:
      <select id="period" required>
        <option value="">‡¶¶‡¶ø‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
        <option>‡ßß‡¶Æ ‡¶¶‡¶ø‡¶®</option>
        <option>‡ß®‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®</option>
        <option>‡ß©‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®</option>
        <option>‡ß™‡¶∞‡ßç‡¶• ‡¶¶‡¶ø‡¶®</option>
        <option>‡ß´‡¶Æ ‡¶¶‡¶ø‡¶®</option>
        <option>‡ß¨‡¶∑‡ßç‡¶† ‡¶¶‡¶ø‡¶®</option>
        <option>‡ß≠‡¶Æ ‡¶¶‡¶ø‡¶®</option>
      </select>
    </label>

    <label>‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º:
      <select id="subjectSelect" required>
        <option value="">‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
        <option>‡¶Ü‡¶∞‡¶¨‡ßÄ ‡¶≤‡ßá‡¶ñ‡¶æ</option>
        <option>‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø</option>
        <option>‡¶ó‡¶£‡¶ø‡¶§</option>
        <option>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
        <option>‡¶π‡¶æ‡¶¶‡¶ø‡¶∏</option>
        <option>‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶®</option>
        <option>‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶§</option>
        <option value="add-new">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®...</option>
      </select>
    </label>

    <label id="newSubjectLabel" style="display:none;">‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º:
      <input type="text" id="newSubjectInput" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" />
    </label>

    <label>‡¶∏‡¶Æ‡¶Ø‡¶º:
      <select id="timeSelect">
        <option value="">‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</option>
        <option>‡¶¨‡¶ø‡¶ï‡¶æ‡¶≤</option>
        <option>‚ùå</option>
      </select>
    </label>

    <button type="submit">‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
  </form>

  <div id="routineContainer">
    <table id="routineTable">
      <thead>
        <tr>
          <th>‡¶¶‡¶ø‡¶®</th>
          <th class="editable-header" onclick="editHeader(this)">‡ßß‡¶Æ ‡¶¶‡¶ø‡¶®</th>
          <th class="editable-header" onclick="editHeader(this)">‡ß®‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®</th>
          <th class="editable-header" onclick="editHeader(this)">‡ß©‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®</th>
          <th class="editable-header" onclick="editHeader(this)">‡ß™‡¶∞‡ßç‡¶• ‡¶¶‡¶ø‡¶®</th>
          <th class="editable-header" onclick="editHeader(this)">‡ß´‡¶Æ ‡¶¶‡¶ø‡¶®</th>
          <th class="editable-header" onclick="editHeader(this)">‡ß¨‡¶∑‡ßç‡¶† ‡¶¶‡¶ø‡¶®</th>
          <th class="editable-header" onclick="editHeader(this)">‡ß≠‡¶Æ ‡¶¶‡¶ø‡¶®</th>
        </tr>
         <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
        </tr>
         <th>‡¶¨‡¶æ‡¶∞</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
          <th class="editable-header" onclick="editHeader(this)">-</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="class-header">‡¶∂‡¶ø‡¶∂‡ßÅ</td>
          <td class="editable-cell" data-class="‡¶∂‡¶ø‡¶∂‡ßÅ" data-period="‡ßß‡¶Æ ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶∂‡¶ø‡¶∂‡ßÅ" data-period="‡ß®‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶∂‡¶ø‡¶∂‡ßÅ" data-period="‡ß©‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶∂‡¶ø‡¶∂‡ßÅ" data-period="‡ß™‡¶∞‡ßç‡¶• ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶∂‡¶ø‡¶∂‡ßÅ" data-period="‡ß´‡¶Æ ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶∂‡¶ø‡¶∂‡ßÅ" data-period="‡ß¨‡¶∑‡ßç‡¶† ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶∂‡¶ø‡¶∂‡ßÅ" data-period="‡ß≠‡¶Æ ‡¶¶‡¶ø‡¶®"></td>
        </tr>
        <tr>
          <td class="class-header">‡¶™‡ßç‡¶∞‡¶•‡¶Æ</td>
          <td class="editable-cell" data-class="‡¶™‡ßç‡¶∞‡¶•‡¶Æ" data-period="‡ßß‡¶Æ ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶™‡ßç‡¶∞‡¶•‡¶Æ" data-period="‡ß®‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶™‡ßç‡¶∞‡¶•‡¶Æ" data-period="‡ß©‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶™‡ßç‡¶∞‡¶•‡¶Æ" data-period="‡ß™‡¶∞‡ßç‡¶• ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶™‡ßç‡¶∞‡¶•‡¶Æ" data-period="‡ß´‡¶Æ ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶™‡ßç‡¶∞‡¶•‡¶Æ" data-period="‡ß¨‡¶∑‡ßç‡¶† ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶™‡ßç‡¶∞‡¶•‡¶Æ" data-period="‡ß≠‡¶Æ ‡¶¶‡¶ø‡¶®"></td>
        </tr>
        <tr>
          <td class="class-header">‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º</td>
          <td class="editable-cell" data-class="‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ßß‡¶Æ ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ß®‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ß©‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ß™‡¶∞‡ßç‡¶• ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ß´‡¶Æ ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ß¨‡¶∑‡ßç‡¶† ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ß≠‡¶Æ ‡¶¶‡¶ø‡¶®"></td>
        </tr>
        <tr>
          <td class="class-header">‡¶§‡ßÉ‡¶§‡ßÄ‡¶Ø‡¶º</td>
          <td class="editable-cell" data-class="‡¶§‡ßÉ‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ßß‡¶Æ ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶§‡ßÉ‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ß®‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶§‡ßÉ‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ß©‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶§‡ßÉ‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ß™‡¶∞‡ßç‡¶• ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶§‡ßÉ‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ß´‡¶Æ ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶§‡ßÉ‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ß¨‡¶∑‡ßç‡¶† ‡¶¶‡¶ø‡¶®"></td>
          <td class="editable-cell" data-class="‡¶§‡ßÉ‡¶§‡ßÄ‡¶Ø‡¶º" data-period="‡ß≠‡¶Æ ‡¶¶‡¶ø‡¶®"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="download-buttons">
    <button onclick="downloadAsImage()">üì∏ JPG ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
    <button onclick="downloadAsPDF()">üìÑ PDF ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
    <button onclick="clearAll()">üóëÔ∏è ‡¶∏‡¶¨ ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
  <button onclick="resetRoutine()">üîÑ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button> <!-- ‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶æ‡¶ü‡¶® -->
</div>

  </div>

  <script>
    let routineData = {
      headers: ['‡ßß‡¶Æ ‡¶¶‡¶ø‡¶®', '‡ß®‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®', '‡ß©‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®', '‡ß™‡¶∞‡ßç‡¶• ‡¶¶‡¶ø‡¶®', '‡ß´‡¶Æ ‡¶¶‡¶ø‡¶®', '‡ß¨‡¶∑‡ßç‡¶† ‡¶¶‡¶ø‡¶®', '‡ß≠‡¶Æ ‡¶¶‡¶ø‡¶®'],
      subjects: ['‡¶Ü‡¶∞‡¶¨‡ßÄ ‡¶≤‡ßá‡¶ñ‡¶æ', '‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø', '‡¶ó‡¶£‡¶ø‡¶§', '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ', '‡¶π‡¶æ‡¶¶‡¶ø‡¶∏', '‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶®', '‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶§'],
      cellData: {},
      // ‡¶®‡¶§‡ßÅ‡¶®: dateBarData - ‡¶ú‡¶æ‡¶Æ‡¶æ‡¶§‡ßá‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ row ‡¶è‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ
      dateBarData: ['‡ßß', '‡ß®', '‡ß©', '‡ß™', '‡ß´', '‡ß¨', '‡ß≠']
    };

    function loadData() {
      const stored = localStorage.getItem('routineData');
      if (stored) {
        routineData = JSON.parse(stored);
      }

      // ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶≤‡ßã‡¶°
      const headers = document.querySelectorAll('.editable-header');
      headers.forEach((header, index) => {
        if (routineData.headers[index]) {
          header.textContent = routineData.headers[index];
        }
      });

      // subjectSelect ‡¶≤‡ßã‡¶°
      const subjectSelect = document.getElementById('subjectSelect');
      const addNewOption = subjectSelect.querySelector('option[value="add-new"]');
      subjectSelect.innerHTML = '<option value="">‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
      routineData.subjects.forEach(subject => {
        const option = document.createElement('option');
        option.textContent = subject;
        subjectSelect.appendChild(option);
      });
      if(addNewOption) subjectSelect.appendChild(addNewOption);

      // cellData ‡¶≤‡ßã‡¶°
      Object.keys(routineData.cellData).forEach(key => {
        const data = routineData.cellData[key];
        const cell = document.querySelector(`[data-class="${data.class}"][data-period="${data.period}"]`);
        if (cell) {
          cell.textContent = data.content;
          cell.style.backgroundColor = data.bgColor || '';
        }
      });

      // ‡¶®‡¶§‡ßÅ‡¶®: dateBarData ‡¶≤‡ßã‡¶°
      const dateBarCells = document.querySelectorAll('#dateBarRow td.editable-cell');
      dateBarCells.forEach((cell, i) => {
        if (routineData.dateBarData[i]) {
          cell.textContent = routineData.dateBarData[i];
        }
      });
    }

    function saveData() {
      // cellData ‡¶∏‡ßá‡¶≠
      routineData.cellData = {};
      document.querySelectorAll('.editable-cell').forEach(cell => {
        const className = cell.getAttribute('data-class');
        const period = cell.getAttribute('data-period');
        const content = cell.textContent.trim();
        if (className && period) {
          const key = `${className}-${period}`;
          if (content) {
            routineData.cellData[key] = {
              class: className,
              period: period,
              content: content,
              bgColor: cell.style.backgroundColor
            };
          }
        }
      });

      // header ‡¶∏‡ßá‡¶≠
      const headers = document.querySelectorAll('.editable-header');
      headers.forEach((header, index) => {
        routineData.headers[index] = header.textContent;
      });

      // ‡¶®‡¶§‡ßÅ‡¶®: dateBarData ‡¶∏‡ßá‡¶≠
      const dateBarCells = document.querySelectorAll('#dateBarRow td.editable-cell');
      routineData.dateBarData = [];
      dateBarCells.forEach(cell => {
        routineData.dateBarData.push(cell.textContent.trim());
      });

      localStorage.setItem('routineData', JSON.stringify(routineData));
    }

    const subjectSelect = document.getElementById('subjectSelect');
    const newSubjectLabel = document.getElementById('newSubjectLabel');
    const newSubjectInput = document.getElementById('newSubjectInput');

    subjectSelect.addEventListener('change', function () {
      if (this.value === 'add-new') {
        newSubjectLabel.style.display = 'block';
        newSubjectInput.required = true;
      } else {
        newSubjectLabel.style.display = 'none';
        newSubjectInput.required = false;
      }
    });

    function editHeader(headerElement) {
      const currentText = headerElement.textContent;
      const input = document.createElement('input');
      input.type = 'text';
      input.value = currentText;
      input.style.width = '100%';
      input.style.border = 'none';
      input.style.background = 'transparent';
      input.style.fontSize = 'inherit';
      input.style.textAlign = 'center';
      input.style.fontFamily = 'inherit';
      input.style.fontWeight = 'bold';

      headerElement.innerHTML = '';
      headerElement.appendChild(input);
      input.focus();
      input.select();

      const saveValue = () => {
        const newText = input.value.trim() || currentText;
        headerElement.textContent = newText;

        // ‡¶™‡¶ø‡¶∞‡¶ø‡ßü‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶è‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        const periodSelect = document.getElementById('period');
        const options = periodSelect.querySelectorAll('option');
        options.forEach(option => {
          if (option.textContent === currentText) {
            option.textContent = newText;
            option.value = newText;
          }
        });

        // ‡¶°‡ßá‡¶ü‡¶æ-‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßç‡¶∞‡¶ø‡¶¨‡¶ø‡¶â‡¶ü ‡¶™‡¶ø‡¶∞‡¶ø‡ßü‡¶° ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        document.querySelectorAll(`[data-period="${currentText}"]`).forEach(cell => {
          cell.setAttribute('data-period', newText);
        });

        saveData();
      };

      input.addEventListener('blur', saveValue);
      input.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') saveValue();
      });
    }

    // ‡¶®‡¶§‡ßÅ‡¶®: ‡¶ú‡¶æ‡¶Æ‡¶æ‡¶§ Row ‡¶è‡¶∞ editable cell ‡¶ó‡ßÅ‡¶≤‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶°‡¶ø‡¶ü ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü
    document.querySelectorAll('#dateBarRow td.editable-cell').forEach(cell => {
      cell.addEventListener('blur', saveData);
      // ‡¶á‡¶®‡¶™‡ßÅ‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶á‡¶§‡ßã‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá contenteditable=true ‡¶Ü‡¶õ‡ßá, ‡¶§‡¶æ‡¶á ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶®‡ßá‡¶á
    });

    document.getElementById('routineForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const timeSlot = document.getElementById('timeSelect').value;
      const className = document.getElementById('class').value;
      const period = document.getElementById('period').value;
      let subject = subjectSelect.value;

      // ‡¶∏‡¶Æ‡ßü ‡¶°‡ßç‡¶∞‡¶™‡¶°‡¶æ‡¶â‡¶® required ‡¶®‡¶Ø‡¶º, ‡¶§‡¶æ‡¶á ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ú‡¶æ‡¶Æ‡¶æ‡¶§ ‡¶è‡¶¨‡¶Ç ‡¶¶‡¶ø‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨‡ßã
      if (!className || !period) {
        alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶ú‡¶æ‡¶Æ‡¶æ‡¶§ ‡¶è‡¶¨‡¶Ç ‡¶¶‡¶ø‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        return;
      }

      if (subject === 'add-new') {
        subject = newSubjectInput.value.trim();
        if (!subject) {
          alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§');
          return;
        }
        const newOption = document.createElement('option');
        newOption.textContent = subject;
        subjectSelect.insertBefore(newOption, subjectSelect.querySelector('option[value="add-new"]'));
        subjectSelect.value = subject;
        if (!routineData.subjects.includes(subject)) {
          routineData.subjects.push(subject);
        }
      }

      const targetCell = document.querySelector(`[data-class="${className}"][data-period="${period}"]`);
      if (targetCell) {
        if (timeSlot === '‚ùå') {
          targetCell.textContent = '‚ùå';
          targetCell.style.backgroundColor = '#ffebee';
        } else if(timeSlot) {
          targetCell.textContent = `${subject} (${timeSlot})`;
          targetCell.style.backgroundColor = '#e8f5e8';
        } else {
          // ‡¶∏‡¶Æ‡ßü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
          targetCell.textContent = subject;
          targetCell.style.backgroundColor = '#e8f5e8';
        }
      }

      this.reset();
      newSubjectLabel.style.display = 'none';
      saveData();
    });

    // editable-cell ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶è‡¶°‡¶ø‡¶ü‡¶ø‡¶Ç (body table cells except dateBarRow)
    document.querySelectorAll('.editable-cell').forEach(cell => {
      // ‡¶®‡¶§‡ßÅ‡¶®: ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ø‡¶¶‡¶ø contenteditable=false ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶ñ‡¶®‡¶á ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü
      if(!cell.isContentEditable) {
        cell.addEventListener('click', function() {
          const currentText = this.textContent;
          const input = document.createElement('input');
          input.type = 'text';
          input.value = currentText;
          input.style.width = '100%';
          input.style.border = 'none';
          input.style.background = 'transparent';
          input.style.fontSize = 'inherit';
          input.style.textAlign = 'center';
          input.style.fontFamily = 'inherit';

          this.innerHTML = '';
          this.appendChild(input);
          input.focus();

          const saveValue = () => {
            this.textContent = input.value;
            this.style.backgroundColor = input.value.trim() ? '#e8f5e8' : '';
            saveData();
          };

          input.addEventListener('blur', saveValue);
          input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') saveValue();
          });
        });
      }
    });

    function downloadAsImage() {
      html2canvas(document.getElementById("routineContainer")).then(canvas => {
        const link = document.createElement("a");
        link.download = "routine.jpg";
        link.href = canvas.toDataURL("image/jpeg");
        link.click();
      });
    }

    function downloadAsPDF() {
      html2canvas(document.getElementById("routineContainer")).then(canvas => {
        const imgData = canvas.toDataURL("image/jpeg");
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        const width = pdf.internal.pageSize.getWidth();
        const height = (canvas.height * width) / canvas.width;
        pdf.addImage(imgData, "JPEG", 0, 10, width, height);
        pdf.save("routine.pdf");
      });
    }

    function clearAll() {
      if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
        document.querySelectorAll('.editable-cell').forEach(cell => {
          cell.textContent = '';
          cell.style.backgroundColor = '';
        });
        routineData.cellData = {};
        routineData.dateBarData = ['', '', '', '', '', '', ''];
        saveData();
      }
    }

    loadData();

function resetRoutine() {
  if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§')) {
    localStorage.removeItem('routineData');
    location.reload();
  }
}


  </script>
</body>
</html>
